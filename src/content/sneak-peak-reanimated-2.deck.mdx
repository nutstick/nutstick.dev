---
title: 'Sneak peak Reanimated 2'
date: '2020-06-09T15:06:54.864Z'
description: 'Hello World'
---

import Box from './sneak-peak-reanimated-2/box'
import api from '../img/animated-api-not-support.png'
import { Split, FullScreenCode } from '../components/decks'


# Reanimated 2

---

# react-native's Animated API

---

# Animated.timing

<Box animation="smooth" />

```jsx
Animated.timing(xPosition, {
  toValue: 100,
  duration: 2000
}).start()

<Animated.View
  style={[
    style,
    {transform: [{translateX: xPosition}]}
  ]}
/>
```

---

## `requestAnimationFrame`

<Box animation="lag" />

JS thread is busy; FPS < 60

---

# useNativeDriver: true

- 👍 Native do looping
- 👍 More chance to have 60FPS

---

## 👎

some style props or easing can't use

<img src={api} style={{maxWidth: 500, height: 'auto'}}/>

---

## 👎

No imperative logic e.g. if/else/loop

```jsx
Animated.add(valueX, valueY).interpolate({
  inputRange: [0, 1],
  outputRange: [0, 100]
})
```

---

# Reanimated

---

# Reanimated

- Always `useNativeDriver: true`
- More style support
- More method/logic support e.g. `cond`, `clock`, `define`
- 100% Declarative animation

---

### Sample

<FullScreenCode>

```jsx
function runTiming(clock, value, dest) {
  const state = {
    finished: new Value(0),
    position: new Value(0),
    time: new Value(0),
    frameTime: new Value(0)
  }

  return block([
    cond(
      clockRunning(clock),
      [set(config.toValue, dest)],
      [
        set(state.position, value),
        set(config.toValue, dest),
        startClock(clock)
      ]
    ),
    timing(clock, state, config),
    cond(state.finished, debug('stop clock', stopClock(clock))),
    state.position
  ])
}

<Animated.View
  style={{ transform: [{ translateX: runTiming(clock, -120, 120); }] }}
/>
```
</FullScreenCode>

---

# v2 🎉

You can write it as a normal JS

---

# Worklet

- Special JS function that can run in any thread

- powered by `babel` to make it **Pure function**

<FullScreenCode>

<Split separator={<div style={{minWidth: '3em', textAlign: 'center', fontSize: 32}}>👉</div>}>

```js
const updateScroll = event => {
  'worklet'
  scrollY.value = event.contentOffset.y
  updateFrames()
}
```

```js
_f._closure = {
  scrollY: scrollY,
  updateFrames: updateFrames
}
_f.asString = 'function(event){const{scro...'
```

</Split>

</FullScreenCode>

---

```js
function(event) {
  const {scrollY,updateFrames} = this._closure;
  {
    scrollY.value=event.contentOffset.y;
    updateFrames();
  }
}
```

- Value will capture (`this._closure`) before runn on UI thread
- **copy** equals to never change

---

# runOnUI

```js
function callback(text) {
  console.log('Running on the RN thread', text);
}

function returningWorklet() {
  'worklet';
  return "I'm back";
}

function someWorklet() {
  'worklet';
  callback('I'm on UI but can call methods from the RN thread');
  console.log('On the UI thread, other worklet says', what);
}
```

---

# Share value

- thread safe variable
- can change in worklet
- powered by JSI

---

```jsx
function ScrollExample() {
  const translationY = useSharedValue(0)

  const scrollHandler = useAnimatedScrollHandler(event => {
    translationY.value = event.contentOffset.y
  })

  const stylez = useAnimatedStyle(() => {
    return { transform: [{ translateY: transY.value }] }
  })

  return (
    <View style={styles.container}>
      <Animated.View style={[styles.box, stylez]} />
      <Animated.ScrollView
        style={styles.scroll}
        onScroll={scrollHandler}
        scrollEventThrottle={16}
      >
        <Content />
      </Animated.ScrollView>
    </View>
  )
}
```

---

# Issues?

---

# Conclusion

- TurboModules
- Sneak peak of Fabric
- Multi thread programing in JS!!!
